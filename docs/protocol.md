Новый формат. 

# Заголовок
stream  20
флаги  4
номер функции  8


Версия протоколе передается при запросе http в хеадере, токен так-же передается в хеадере. 

# первое сообщение конфигурация. 
Версия 
Таймаут
Сервис

* Состояние
  - 15 первый кадр
  - 14 команда потока
  - 13 ошибка потока
  - 12 последний кадр
  - 11 ошибка сервиса
  - 0 сообщение в потоке

* Коды ошибок
  - TIMEOUT Закрыт по таймауту
  - CLIENT_DISCONNECT Закрыт по таймауту
  - SERVICE_DISCONNECT Закрыт по таймауту
  - STREAM_NOT_FOUND Закрыт по таймауту
  - WS_STREAM_COLLISION Подключено к другому
  - ZMQ_STREAM_COLLISION Подключено к другому
  - ENDPOINT_NOT_FOUND Закрыт по таймауту

* Заданные функции сервиса
  - 0 - интерфейс серфиса

### Заголовок V2 WS -> HUB
- [0:32] 32 бита - id стрима BigEndian (ok)
- [32:40] 8 бит - состояние
- [40:48] 8 бит - функция сервиса
+ [48:64] 16 бит - номер сервиса если это первое.
- [48/64:] тело

### Заголовок V2  HUB -> ZMQ
- [0:32] 32 бита - id стрима BigEndian (ok)
- [32:40] 8 бит - состояние
- [40:48] 8 бит - функция сервиса
+ [48:64]16 бит - номер юзера если это первое.
- [48/64:] тело

### Залоговок  ZMQ -> HUB
- [0:32] 32 бита - id стрима BigEndian (ok)
- [32:40]8 бит - состояние
- [40:48] 8 бит -  параметры от сервиса.
- [48:] тело

### Заголовок  HUB -> WS
- [0:32] 32 бита - id стрима BigEndian (ok)
- [32:40] 8 бит - состояние
- [40:48] 8 бит -  параметры от сервиса.
- [48:] тело





* Состояние
* 15 закрыть стрим по команде

# дыры
- Клиент может посылать сообщения в любые стримы
- Сервер может послать сообщения в другой стрим который принадлежит другому сервису
- Сервер может послать сообщение уже умершему стриму
- Стрим закрытый может быть открыт заново и получить сообщение.



# Правила 
- на любое сообщение WS должен приходить ответ.
- при отключении WS убиваются все связанные стримы.
- при отключению ZMQ убиваются все связанные стримы.
- когда стрим убивается приходят сообщения всем слушателям.
- стримы должны удаляться по таймауту.
- сообщение ping
- должна быть команда закрытия стрима с WS


